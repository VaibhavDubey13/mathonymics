<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>∀ Hidden Patterns — Mathonymics</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
:root{--black:#000;--bg:#03030a;--bg2:#07070f;--s1:rgba(255,255,255,.03);--border:rgba(255,255,255,.07);--borderp:rgba(168,85,247,.25);--p1:#7e22ce;--p2:#a855f7;--p3:#c084fc;--pg:rgba(168,85,247,.12);--text:#f0eeff;--text2:rgba(240,238,255,.55);--text3:rgba(240,238,255,.25);--mono:'Fira Code',monospace;--disp:'Syne',sans-serif;--ease:cubic-bezier(.16,1,.3,1)}
body{background:var(--black);color:var(--text);font-family:var(--mono);font-size:13px;line-height:1.75;overflow-x:hidden;cursor:none}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:var(--p1);border-radius:2px}
#ambientCanvas{position:fixed;inset:0;z-index:0;pointer-events:none}
.vig{position:fixed;inset:0;z-index:1;pointer-events:none;background:radial-gradient(ellipse 80% 80% at 50% 50%,transparent 45%,rgba(0,0,0,.75) 100%)}
#progress{position:fixed;top:0;left:0;height:2px;width:0%;background:linear-gradient(90deg,var(--p1),var(--p3),#e879f9);z-index:9999;box-shadow:0 0 10px var(--p2)}
#cdot{position:fixed;width:6px;height:6px;background:var(--p3);border-radius:50%;pointer-events:none;z-index:9998;transform:translate(-50%,-50%);box-shadow:0 0 8px var(--p2),0 0 20px rgba(168,85,247,.4);transition:width .15s,height .15s}
#cring{position:fixed;width:28px;height:28px;border:1px solid rgba(168,85,247,.35);border-radius:50%;pointer-events:none;z-index:9997;transform:translate(-50%,-50%)}
#cring::before,#cring::after{content:'';position:absolute;background:rgba(168,85,247,.3)}
#cring::before{width:1px;height:6px;left:50%;top:-10px;transform:translateX(-50%)}
#cring::after{width:6px;height:1px;top:50%;left:-10px;transform:translateY(-50%)}
body.ch #cdot{width:12px;height:12px}body.ch #cring{width:48px;height:48px;border-color:rgba(168,85,247,.6)}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.72' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");opacity:.018;pointer-events:none;z-index:998}
nav{position:fixed;top:0;left:0;right:0;z-index:500;padding:0 48px;height:62px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:rgba(0,0,0,.55);backdrop-filter:blur(28px)}
.nl{font-family:var(--disp);font-weight:800;font-size:15px;letter-spacing:-.04em;color:var(--text);text-decoration:none;display:inline-flex;align-items:center;gap:8px}
.nldot{width:5px;height:5px;background:var(--p2);border-radius:50%;box-shadow:0 0 8px var(--p2)}
.nav-right{display:flex;gap:12px;align-items:center}
.nav-back{font-family:var(--mono);font-size:10px;letter-spacing:.1em;color:var(--text2);border:1px solid var(--border);padding:5px 12px;border-radius:100px;text-decoration:none;transition:all .25s}
.nav-back:hover{border-color:var(--borderp);color:var(--p3)}
.hub-badge{font-size:12px;color:var(--p3);background:rgba(168,85,247,.1);border:1px solid rgba(168,85,247,.2);padding:4px 14px;border-radius:100px;letter-spacing:.08em}
/* HUB HERO */
.hub-hero{position:relative;z-index:2;min-height:50vh;display:flex;align-items:center;padding:120px 48px 60px;max-width:1100px;margin:0 auto}
.hub-sym{font-size:clamp(80px,14vw,160px);color:rgba(168,85,247,.07);position:absolute;right:48px;top:50%;transform:translateY(-50%);line-height:1;pointer-events:none}
.hub-eyebrow{font-size:10px;letter-spacing:.25em;text-transform:uppercase;color:var(--p2);margin-bottom:18px;display:flex;align-items:center;gap:10px}
.hub-eyebrow::before{content:'';width:24px;height:1px;background:var(--p2)}
.hub-title{font-family:var(--disp);font-weight:800;font-size:clamp(42px,7vw,80px);line-height:.97;letter-spacing:-.045em;margin-bottom:20px}
.hub-title span{background:linear-gradient(125deg,#c084fc 0%,#a855f7 45%,#6d28d9 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hub-desc{font-size:14px;color:var(--text2);max-width:520px;line-height:1.85}
.dline{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent)}
.sw{position:relative;z-index:2;max-width:1100px;margin:0 auto;padding:72px 48px}
.sl{font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--p2);margin-bottom:12px;display:flex;align-items:center;gap:9px}
.sl::before{content:'';display:inline-block;width:18px;height:1px;background:var(--p2)}
.st{font-family:var(--disp);font-weight:800;font-size:clamp(24px,3.5vw,38px);letter-spacing:-.04em;line-height:1.1;margin-bottom:36px}
/* GALLERY GRID */
.gallery-controls{display:flex;gap:10px;margin-bottom:24px;flex-wrap:wrap;align-items:center}
.gc-btn{font-family:var(--mono);font-size:10px;letter-spacing:.08em;color:var(--text2);background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:8px;padding:7px 16px;cursor:none;transition:all .25s}
.gc-btn.active,.gc-btn:hover{color:var(--p3);border-color:rgba(168,85,247,.3);background:rgba(168,85,247,.06)}
.gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
.gallery-item{position:relative;border:1px solid var(--border);border-radius:12px;overflow:hidden;cursor:none;transition:all .35s var(--ease);background:#000}
.gallery-item:hover{border-color:rgba(168,85,247,.3);transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,0,0,.6),0 0 0 1px rgba(168,85,247,.1)}
.gallery-item canvas{display:block;width:100%}
.gallery-label{position:absolute;bottom:0;left:0;right:0;padding:12px 16px;background:linear-gradient(to top,rgba(0,0,0,.8),transparent);font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--text2)}
.gallery-label strong{color:var(--p3);display:block;font-family:var(--disp);font-size:13px;letter-spacing:-.01em;margin-bottom:2px}
.remix-btn{position:absolute;top:10px;right:10px;font-family:var(--mono);font-size:9px;letter-spacing:.08em;color:var(--p3);background:rgba(0,0,0,.7);border:1px solid rgba(168,85,247,.3);border-radius:6px;padding:5px 10px;cursor:none;opacity:0;transition:opacity .25s}
.gallery-item:hover .remix-btn{opacity:1}
/* LIVE GENERATOR */
.gen-wrap{position:relative;z-index:2;border-top:1px solid var(--border);background:var(--bg2)}
.gen-inner{max-width:1100px;margin:0 auto;padding:72px 48px}
.gen-canvas-wrap{position:relative;border:1px solid var(--borderp);border-radius:14px;overflow:hidden;background:#000;margin-bottom:16px}
.gen-canvas-wrap canvas{display:block;width:100%}
.gen-controls{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
.gcl{font-size:10px;color:var(--text2)}
.gsl{-webkit-appearance:none;width:110px;height:2px;background:rgba(168,85,247,.2);border-radius:2px;outline:none;cursor:none}
.gsl::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:var(--p2);border-radius:50%;cursor:none;box-shadow:0 0 8px var(--p2)}
.gbtn{font-family:var(--mono);font-size:10px;color:var(--p3);background:rgba(168,85,247,.08);border:1px solid rgba(168,85,247,.2);border-radius:6px;padding:6px 14px;cursor:none;transition:all .2s}
.gbtn:hover{background:rgba(168,85,247,.15)}
.hub-footer{position:relative;z-index:2;border-top:1px solid var(--border);padding:28px 48px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;background:rgba(0,0,0,.4)}
.hfl{font-family:var(--disp);font-weight:800;font-size:13px;letter-spacing:-.03em;color:var(--text3)}
.hfl a{color:inherit;text-decoration:none;transition:color .2s}.hfl a:hover{color:var(--p3)}
@keyframes rup{from{opacity:0;transform:translateY(26px)}to{opacity:1;transform:translateY(0)}}
.rev{opacity:0;transform:translateY(24px);transition:opacity .8s var(--ease),transform .8s var(--ease)}.rev.vis{opacity:1;transform:translateY(0)}
@media(max-width:900px){nav{padding:0 20px}.hub-hero{padding:100px 20px 48px}.sw{padding:52px 20px}.gen-inner{padding:52px 20px}.hub-footer{padding:24px 20px}}
</style>
</head>
<body>
<canvas id="ambientCanvas"></canvas>
<div class="vig"></div>
<div id="progress"></div>
<div id="cdot"></div>
<div id="cring"></div>

<nav>
  <a href="index.html" class="nl"><div class="nldot"></div>Mathonymics</a>
  <div class="nav-right">
    <span class="hub-badge">∀ Hidden Patterns</span>
    <a href="index.html" class="nav-back">← Back home</a>
  </div>
</nav>

<div class="hub-hero">
  <div class="hub-sym">∀</div>
  <div>
    <div class="hub-eyebrow">Dimension 08</div>
    <h1 class="hub-title"><span>Hidden Patterns</span></h1>
    <p class="hub-desc">Procedurally generated art from mathematical systems. Reaction diffusion, flow fields, Perlin noise, cellular automata — patterns that emerge from rules, not design.</p>
  </div>
</div>

<div class="dline"></div>
<div class="sw">
  <div class="sl rev">Gallery</div>
  <h2 class="st rev">Generated pieces</h2>
  <div class="gallery-controls rev">
    <button class="gc-btn active" data-filter="all">All patterns</button>
    <button class="gc-btn" data-filter="rd">Reaction Diffusion</button>
    <button class="gc-btn" data-filter="flow">Flow Fields</button>
    <button class="gc-btn" data-filter="cellular">Cellular</button>
    <button class="gc-btn" data-filter="fractal">Fractal</button>
  </div>
  <div class="gallery-grid" id="gallery"></div>
</div>

<div class="gen-wrap">
  <div class="gen-inner">
    <div class="sl rev">Live Generator</div>
    <h2 class="st rev">Create your own</h2>
    <div class="gen-canvas-wrap">
      <canvas id="genCanvas" width="1000" height="380"></canvas>
    </div>
    <div class="gen-controls" id="genControls"></div>
  </div>
</div>

<div class="hub-footer">
  <span class="hfl"><a href="index.html">Mathonymics</a> / ∀ Hidden Patterns</span>
  <div style="display:flex;gap:20px">
    <a href="hub-mathematics.html" style="font-size:10px;color:var(--text3);text-decoration:none" onmouseenter="this.style.color='var(--p3)'" onmouseleave="this.style.color='var(--text3)'">∫ Mathematics →</a>
  </div>
</div>

<script>
/* AMBIENT */
(()=>{
  const cv=document.getElementById('ambientCanvas'),ctx=cv.getContext('2d');
  const SYMS=['∂','∫','∑','∞','π','Δ','√','∀','∃','φ'];
  let W,H,syms=[],mouse={x:0,y:0},t=0;
  function resize(){W=cv.width=innerWidth;H=cv.height=innerHeight}
  function Sym(){this.x=Math.random()*W;this.y=Math.random()*H;this.char=SYMS[Math.floor(Math.random()*SYMS.length)];this.sz=Math.random()*10+8;this.ba=Math.random()*.06+.02;this.a=this.ba;this.vx=(Math.random()-.5)*.15;this.vy=(Math.random()-.5)*.15;this.depth=Math.random()*.8+.2;this.pp=Math.random()*Math.PI*2;this.hue=270+Math.random()*35}
  function init(){syms=[];const n=Math.min(Math.floor(W*H/15000),80);for(let i=0;i<n;i++)syms.push(new Sym())}
  function loop(){requestAnimationFrame(loop);ctx.clearRect(0,0,W,H);t+=.01;syms.forEach(s=>{const px=(mouse.x-W/2)*s.depth*.01,py=(mouse.y-H/2)*s.depth*.01;s.x+=s.vx;s.y+=s.vy;s.a=s.ba*(.7+.3*Math.sin(t*s.pp*10));if(s.x<-40)s.x=W+20;if(s.x>W+40)s.x=-20;if(s.y<-40)s.y=H+20;if(s.y>H+40)s.y=-20;ctx.save();ctx.globalAlpha=s.a;ctx.fillStyle=`hsl(${s.hue},70%,70%)`;ctx.font=`${s.sz}px 'Fira Code',monospace`;ctx.fillText(s.char,s.x+px,s.y+py);ctx.restore()})}
  window.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY},{passive:true});
  window.addEventListener('resize',()=>{resize();init()},{passive:true});
  resize();init();loop();
})();
/* CURSOR */
(()=>{
  const dot=document.getElementById('cdot'),ring=document.getElementById('cring');
  let mx=0,my=0,rx=0,ry=0;
  document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY},{passive:true});
  (function a(){dot.style.left=mx+'px';dot.style.top=my+'px';rx+=(mx-rx)*.13;ry+=(my-ry)*.13;ring.style.left=rx+'px';ring.style.top=ry+'px';requestAnimationFrame(a)})();
  document.querySelectorAll('a,button,.gallery-item,.gc-btn').forEach(el=>{el.addEventListener('mouseenter',()=>document.body.classList.add('ch'));el.addEventListener('mouseleave',()=>document.body.classList.remove('ch'))});
})();
const pb=document.getElementById('progress');
window.addEventListener('scroll',()=>{pb.style.width=(window.scrollY/(document.documentElement.scrollHeight-innerHeight)*100)+'%'},{passive:true});
const ro=new IntersectionObserver(e=>{e.forEach(x=>{if(x.isIntersecting){x.target.classList.add('vis');ro.unobserve(x.target)}})},{threshold:.08});
document.querySelectorAll('.rev').forEach(el=>ro.observe(el));

/* GALLERY PIECES */
const PIECES = [
  {title:'Gray-Scott RD',desc:'Coral growth pattern',type:'rd',seed:1},
  {title:'Perlin Flow Field',desc:'Velocity-mapped noise',type:'flow',seed:2},
  {title:'Conway Life',desc:'Cellular automaton',type:'cellular',seed:3},
  {title:'Bifurcation Map',desc:'Logistic chaos diagram',type:'fractal',seed:4},
  {title:'Voronoi Noise',desc:'Distance-based tiles',type:'flow',seed:5},
  {title:'Turing Spots',desc:'Morphogenesis pattern',type:'rd',seed:6},
  {title:'Julia Flow',desc:'Complex iteration field',type:'fractal',seed:7},
  {title:'Lissajous Web',desc:'Parametric harmonics',type:'cellular',seed:8},
];

function renderPiece(canvas, type, seed) {
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const rng = (n) => { // seeded pseudo-random
    let x = Math.sin(n + seed * 137.5) * 10000;
    return x - Math.floor(x);
  };
  ctx.fillStyle = '#03030a';
  ctx.fillRect(0, 0, W, H);

  if (type === 'rd') {
    // Quick reaction diffusion snapshot
    const scale = 4, rw = W/scale, rh = H/scale, sz = rw*rh;
    const A = new Float32Array(sz).fill(1);
    const B = new Float32Array(sz);
    const nA = new Float32Array(sz), nB = new Float32Array(sz);
    const f = 0.035 + rng(seed)*0.02, k = 0.058 + rng(seed+1)*0.015;
    // Seed
    for (let i=-5;i<5;i++) for(let j=-5;j<5;j++){
      const idx=(rh/2+i|0)*rw+(rw/2+j|0); if(idx>=0&&idx<sz){B[idx]=1;A[idx]=0}
    }
    for (let iter=0;iter<180;iter++){
      for(let y=1;y<rh-1;y++) for(let x=1;x<rw-1;x++){
        const i=y*rw+x,a=A[i],b=B[i];
        const lA=A[i-1]+A[i+1]+A[i-rw]+A[i+rw]-4*a,lB=B[i-1]+B[i+1]+B[i-rw]+B[i+rw]-4*b,abb=a*b*b;
        nA[i]=Math.max(0,Math.min(1,a+.9*lA-abb+f*(1-a)));nB[i]=Math.max(0,Math.min(1,b+.45*lB+abb-(k+f)*b));
      }
      A.set(nA);B.set(nB);
    }
    const img = ctx.createImageData(W, H), d = img.data;
    for(let y=0;y<rh;y++) for(let x=0;x<rw;x++){
      const v=1-B[y*rw+x],r=Math.floor(v*110*v),g=Math.floor(v*20),b2=Math.floor(v*180);
      for(let dy=0;dy<scale;dy++) for(let dx=0;dx<scale;dx++){
        const pi=((y*scale+dy)*W+(x*scale+dx))*4;
        d[pi]=r;d[pi+1]=g;d[pi+2]=b2;d[pi+3]=255;
      }
    }
    ctx.putImageData(img,0,0);
  } else if (type === 'flow') {
    // Perlin-like flow field
    const noise = (x,y) => {
      const n = Math.sin(x*1.3+seed)*Math.cos(y*1.1+seed*0.5)+Math.sin(x*.7*y*.8+seed*2)*.5;
      return n;
    };
    for(let i=0;i<3000;i++){
      let px=rng(i*3)*W, py=rng(i*3+1)*H;
      const alpha=rng(i*3+2)*.15+.05;
      const hue=270+rng(i)*40;
      ctx.beginPath();ctx.moveTo(px,py);
      for(let s=0;s<40;s++){
        const angle=noise(px/100,py/100)*Math.PI*2;
        px+=Math.cos(angle)*2.5;py+=Math.sin(angle)*2.5;
        if(px<0||px>W||py<0||py>H)break;
      }
      ctx.strokeStyle=`hsla(${hue},70%,65%,${alpha})`;ctx.lineWidth=.8;ctx.stroke();
    }
  } else if (type === 'cellular') {
    // Conway Game of Life or Lissajous
    if (seed % 2 === 0) {
      // Lissajous
      const a = Math.floor(rng(seed)*4)+2, b = Math.floor(rng(seed+1)*4)+2;
      const delta = rng(seed+2)*Math.PI;
      ctx.beginPath();
      for(let t=0;t<Math.PI*2*200;t+=.01){
        const x=W/2+W*.4*Math.sin(a*t+delta), y=H/2+H*.4*Math.sin(b*t);
        const p=(t/(Math.PI*2*200));
        ctx.strokeStyle=`hsla(${270+p*50},70%,65%,${.4*Math.sin(p*Math.PI)})`;
        ctx.lineWidth=.8;
        if(t===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
        ctx.stroke();ctx.beginPath();ctx.moveTo(x,y);
      }
    } else {
      // Conway random
      const s=4,gw=Math.floor(W/s),gh=Math.floor(H/s);
      let grid=new Uint8Array(gw*gh);
      for(let i=0;i<grid.length;i++) grid[i]=rng(i+seed*100)>.6?1:0;
      for(let g=0;g<50;g++){
        const ng=new Uint8Array(gw*gh);
        for(let y=1;y<gh-1;y++) for(let x=1;x<gw-1;x++){
          let n=0;for(let dy=-1;dy<=1;dy++) for(let dx=-1;dx<=1;dx++) if(dx||dy) n+=grid[(y+dy)*gw+(x+dx)];
          const alive=grid[y*gw+x];ng[y*gw+x]=(alive&&(n===2||n===3))||(!alive&&n===3)?1:0;
        }
        grid=ng;
      }
      grid.forEach((v,i)=>{if(v){const x=(i%gw)*s,y=Math.floor(i/gw)*s;ctx.fillStyle=`rgba(168,85,247,${.6+rng(i)*.4})`;ctx.fillRect(x,y,s-1,s-1)}});
    }
  } else if (type === 'fractal') {
    // Bifurcation diagram or Julia slice
    if (seed % 2 === 0) {
      // Bifurcation
      ctx.fillStyle='#03030a';ctx.fillRect(0,0,W,H);
      for(let px=0;px<W;px++){
        const r=2.5+px/W*1.5;let x=.5;
        for(let i=0;i<300;i++){x=r*x*(1-x);if(i>200){ctx.fillStyle=`rgba(168,85,247,.4)`;ctx.fillRect(px,H*(1-x),1,1)}}
      }
    } else {
      // Julia field
      for(let py=0;py<H;py++) for(let px=0;px<W;px++){
        let zx=(px-W/2)/Math.min(W,H)*3,zy=(py-H/2)/Math.min(W,H)*3,n=0;
        const cr=-.4+rng(seed)*.3,ci2=.6+rng(seed+1)*.3;
        while(zx*zx+zy*zy<4&&n<60){const t=zx*zx-zy*zy+cr;zy=2*zx*zy+ci2;zx=t;n++}
        if(n<60){const t=n/60;const pi=(py*W+px)*4;
          if(!ctx.getImageData)break; // skip if no pixel access
          ctx.fillStyle=`hsla(${270+t*40},80%,${40+t*40}%,${t*.8})`;
          ctx.fillRect(px,py,1,1);
        }
      }
    }
  }
  // Purple overlay
  const g=ctx.createRadialGradient(W/2,H/2,H*.1,W/2,H/2,H*.6);
  g.addColorStop(0,'transparent');g.addColorStop(1,'rgba(3,3,10,.4)');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
}

function buildGallery(filter='all') {
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  const items = filter === 'all' ? PIECES : PIECES.filter(p => p.type === filter);
  items.forEach(p => {
    const item = document.createElement('div');
    item.className = 'gallery-item';
    item.dataset.type = p.type;
    const canvas = document.createElement('canvas');
    canvas.width = 280; canvas.height = 200;
    const label = document.createElement('div');
    label.className = 'gallery-label';
    label.innerHTML = `<strong>${p.title}</strong>${p.desc}`;
    const btn = document.createElement('button');
    btn.className = 'remix-btn';
    btn.textContent = '⟳ Remix';
    btn.addEventListener('click', () => { renderPiece(canvas, p.type, p.seed + Math.random()*100); });
    item.appendChild(canvas);item.appendChild(label);item.appendChild(btn);
    gallery.appendChild(item);
    setTimeout(() => renderPiece(canvas, p.type, p.seed), 50);
  });
}

document.querySelectorAll('.gc-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.gc-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    buildGallery(btn.dataset.filter);
  });
});

buildGallery();

/* LIVE GENERATOR — Reaction Diffusion */
(()=>{
  const gc=document.getElementById('genCanvas'),ctx=gc.getContext('2d');
  const gcw=gc.parentElement,ctrl=document.getElementById('genControls');
  let W,H,A,B,nA,nB,animId=null,running=false;
  let f=.038,k=.062,dA=.9,dB=.45,scale=3,rw,rh;

  ctrl.innerHTML=`<label class="gcl">Feed</label><input type="range" class="gsl" id="gf" min="1" max="99" value="38"><label class="gcl">Kill</label><input type="range" class="gsl" id="gk" min="1" max="99" value="62"><button class="gbtn" id="grst">Reset</button><button class="gbtn" id="gseed">New Seed</button>`;
  document.getElementById('gf').oninput=e=>{f=+e.target.value/1000};
  document.getElementById('gk').oninput=e=>{k=+e.target.value/1000};
  document.getElementById('grst').onclick=()=>setup();
  document.getElementById('gseed').onclick=()=>{f=.025+Math.random()*.04;k=.055+Math.random()*.015;document.getElementById('gf').value=Math.round(f*1000);document.getElementById('gk').value=Math.round(k*1000);setup()};

  function resize(){W=gcw.clientWidth;H=Math.min(innerWidth<600?240:380,400);gc.width=W;gc.height=H;rw=Math.floor(W/scale);rh=Math.floor(H/scale)}

  function setup(){
    const sz=rw*rh;A=new Float32Array(sz).fill(1);B=new Float32Array(sz);nA=new Float32Array(sz);nB=new Float32Array(sz);
    // Multiple seeds
    for(let n=0;n<5;n++){const sx=Math.floor(Math.random()*rw),sy=Math.floor(Math.random()*rh);for(let i=-6;i<6;i++)for(let j=-6;j<6;j++){const idx=(sy+i|0)*rw+(sx+j|0);if(idx>=0&&idx<sz){B[idx]=1;A[idx]=0}}}
  }

  function step(){
    for(let y=1;y<rh-1;y++)for(let x=1;x<rw-1;x++){
      const i=y*rw+x,a=A[i],b=B[i],lA=A[i-1]+A[i+1]+A[i-rw]+A[i+rw]-4*a,lB=B[i-1]+B[i+1]+B[i-rw]+B[i+rw]-4*b,abb=a*b*b;
      nA[i]=Math.max(0,Math.min(1,a+dA*lA-abb+f*(1-a)));nB[i]=Math.max(0,Math.min(1,b+dB*lB+abb-(k+f)*b));
    }
    A.set(nA);B.set(nB);
  }

  function render(){
    const img=ctx.createImageData(W,H),d=img.data;
    for(let y=0;y<rh;y++)for(let x=0;x<rw;x++){
      const v=1-B[y*rw+x],r=Math.floor(v*126*v),g2=Math.floor(v*34*v*.3),b2=Math.floor(v*200);
      for(let dy=0;dy<scale;dy++)for(let dx=0;dx<scale;dx++){
        const pi=((y*scale+dy)*W+(x*scale+dx))*4;d[pi]=r;d[pi+1]=g2;d[pi+2]=b2;d[pi+3]=255;
      }
    }
    ctx.putImageData(img,0,0);
  }

  function loop(){if(!running)return;step();render();animId=requestAnimationFrame(loop)}

  window.addEventListener('load',()=>{resize();setup();running=true;loop()});
  window.addEventListener('resize',()=>{if(animId)cancelAnimationFrame(animId);resize();setup();if(!animId)loop()},{passive:true});
})();
</script>
</body>
</html>
